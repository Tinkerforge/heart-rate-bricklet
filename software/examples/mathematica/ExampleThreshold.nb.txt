Needs["NETLink`"]
LoadNETAssembly["Tinkerforge",NotebookDirectory[]<>"../../.."]

host="localhost"
port=4223
uid="XYZ"(*Change XYZ to the UID of your Heart Rate Bricklet*)

(*Create IPConnection and device object*)
ipcon=NETNew["Tinkerforge.IPConnection"]
hr=NETNew["Tinkerforge.BrickletHeartRate",uid,ipcon]
ipcon@Connect[host,port]

(*Get threshold callbacks with a debounce time of 10 seconds (10000ms)*)
hr@SetDebouncePeriod[10000]

(*Callback function for heart rate reached callback (parameter has unit bpm)*)
HeartRateReachedCB[sender_,heartRate_]:=
 Print["Heart Rate: "<>ToString[N[Quantity[heartRate,"bpm"]]]]
AddEventHandler[hr@HeartRateReachedCallback,HeartRateReachedCB]

(*Configure threshold for heart rate "greater than 100 bpm" (unit is bpm)*)
option=Tinkerforge`BrickletHeartRate`THRESHOLDUOPTIONUGREATER
hr@SetHeartRateCallbackThreshold[option,100,0]

Input["Click OK to exit"]

(*Clean up*)
ipcon@Disconnect[]
ReleaseNETObject[hr]
ReleaseNETObject[ipcon]
